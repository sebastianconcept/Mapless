<!DOCTYPE html>
<html>
    <head>
  <title>Mapless, obscenely simple object persistence</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="author" content="Sebastian Sastre" />
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" type="text/css" href='css/style.css' />
  <link rel="stylesheet" type="text/css" href='css/highlighter.css' />
  <link rel="shortcut icon" type="image/png" href="favicon.png">
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
  <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
</head>

    <body>
    	<div class="container">
    <div class="header">
        <div class="row">
            <div class="logoWrap">
                <div class="symbol">
                    <img alt="Mapless logo" src="images/symbol.png">
                </div>    
                <div class="center-on-mobiles">
                    <h1>Mapless</h1>
                </div>    
        </div>
        </div>    
    </div>

    <div class="content">
        <section class="intro">
          <h2 class="catchPhrase"><em>Obscenely</em> simple object persistence</h2>
<div class="fluid">
	<div class="row">
		<div class="col-md-4">
			<div class="appeal leftAppeal">
			    <h3>Simple</h3>
			    <p>Low maintenance for real. No instVars. No getters and no setters - just saved models with your data.</p>
			    <a href="#updating">Add data to a model →</a>
			</div>
		</div>
		<div class="col-md-4">
			<div class="appeal middleAppeal">
			    <h3>Composable</h3>
			    <p>Do you need to compose models? But of course you do! No mapping required, just add those (sub)models, save its children first and you're good to go.</p>
			    <a href="#composability">Compose models →</a>
			</div>
		</div>
		<div class="col-md-4">
			<div class="appeal rightAppeal">
			    <h3>Portable</h3>
			    <p>Shared API across backends. i.e.: start with SQLite and easily move to MongoDB or PostgreSQL while caching with Redis.</p>
			    <a href="#portability">Data portability →</a>
			</div>
		</div>

		<!-- <div class="col-md-4">
			<div class="appeal rightAppeal">
			    <h3>Reactive</h3>
			    <p>Observe model events in one image and react with an observer from another image. All in a scalable way.</p>
			    <a href="#reactive">React to model events →</a>
			</div>
		</div>-->
	</div>
</div>
        </section>
        <section class="start">
                <div class="col-md-4 loadNow center-on-mobiles">
                    <h4>Saving Smalltalk objects <em>in seconds</em></h4>
                </div>
                <div class="col-md-8 ">
                    <div class="quickstart">
                        <p class="shellTitle">Load in Pharo</p>
                        <div class="shell">
<figure class="highlight"><pre><code class="language-st" data-lang="st"><span></span><span class="nc">Metacello</span> <span class="nb">new</span>
      <span class="nf">baseline:</span> <span class="s">&#39;Mapless&#39;</span><span class="p">;</span>
      <span class="nf">repository:</span> <span class="s">&#39;github://sebastianconcept/Mapless:latest/src&#39;</span><span class="p">;</span>
      <span class="nf">load</span></code></pre></figure>
</div>

                    </div>
                </div>            
        </section>

        <section class="howDoesItFeel">
                <div class="col-md-5 ">
                    <div class="elaborate">
                        <h5>Your application needs to persist modeled data?</h5>
                        <p>This is what happens when you do it with Mapless:</p>
                        <ol>
                            <li>Create a subclass for them.</li>
                            <li><del>Know in advance what attributes they will need./del></li>
                            <li><del>Create its attributes' instVars.</del></li>
                            <li><del>Make accessors for all of them.</del></li>
                            <li><del>Elegantly map them so it all fits in the database.</del></li>
                            <li><del>Patiently re-map them every time you need to change its design saying 'hi' to object-database mismatches.</del></li>
                            <li>Actually save them.</li>
                            <li>Profit.</li>
                        </ol>
                    </div>
                </div>

                 <div id="screencast" class="col-md-7">
                    <div class="elaborate ">
                        <h5 >Screencast</h5>
                        <p><iframe width="420" height="315" src="//www.youtube.com/embed/BNXXDOPLxtE" frameborder="0" allowfullscreen></iframe></p>
                    </div>
                </div>

                <div class="col-md-12">
                    <div class="elaborate">
                        <h5>How does it look like?</h5>
                        <p>Let's say you want to store and retrieve instances of <code>Task</code> as Mapless models using MongoDB as backend.</p>
                        <p>You basically will create a repository object, create Task instances that you'll save, query, update or delete.</p>
                        <p>Let's see the snippets for that step by step.</p>
                    </div>
                </div>

                <div class="col-md-12">
                    <div class="elaborate">
                        <h5>Create the repository</h5>
                        <p>There are two ways to access MongoDB with Mapless. <code>MaplessStandaloneMongoPool</code> for single server setups and <code>MaplessMongoReplicaSetPool</code> for clusters of <a href="https://www.mongodb.com/docs/manual/replication/" target="_blank"> replica sets</a>.</p>
                        <p>The following example shows a local standalone MongoDB example.</p>
                    </div>
                </div>

                <div class="col-md-9 workspace">
                    <div class="">
                        <p class="shellTitle">Instantiate the repository</p>
                        <div class="shell">
  <figure class="highlight"><pre><code class="language-st" data-lang="st"><span></span> 
  <span class="c">&quot;Create the repository object to use the &#39;TryingMapless&#39; database.</span>
<span class="c">  This repository is for a local standalone MongoDB at localhost:27017&quot;</span> 
  <span class="nv">databaseName</span> <span class="o">:=</span> <span class="s">&#39;TryingMapless&#39;</span><span class="p">.</span> 
  <span class="nv">repository</span> <span class="o">:=</span> <span class="nc">MaplessMongoRepository</span> 
    <span class="nf">for:</span> <span class="nv">databaseName</span> 
    <span class="nf">with:</span> <span class="nc">MaplessStandaloneMongoPool</span> <span class="nf">local</span><span class="p">.</span> 
  </code></pre></figure>
</div>

                    </div>
                </div> 

                <div class="col-md-12">
                    <div class="elaborate extraTop">
                        <h5>Model your data</h5>
                        <p>Creating new instances of your data models have nothing special. You treat them like any other object.</p>
                        <p>The only thing to remark here is that you do not need to create the mutator methods <code>description:</code> nor <code>isComplete:</code> in the <code>Task</code> class.</p>
                    </div>
                </div>                

                <div class="col-md-9 workspace">
                    <div class="">
                        <p class="shellTitle">Create a new model</p>
                        <div class="shell">
<figure class="highlight"><pre><code class="language-st" data-lang="st"><span></span><span class="nc">Mapless</span> <span class="nf">subclass:</span> <span class="ss">#Task</span>
	<span class="nf">instanceVariableNames:</span> <span class="s">&#39;&#39;</span>
	<span class="nf">classVariableNames:</span> <span class="s">&#39;&#39;</span>
	<span class="nf">category:</span> <span class="s">&#39;YourApp&#39;</span><span class="p">.</span>

<span class="c">&quot;Create a task instance&quot;</span>
<span class="nv">task</span> <span class="o">:=</span> <span class="nc">Task</span> <span class="nb">new</span> 
	<span class="nf">description:</span> <span class="s">&#39;Try Mapless&#39;</span><span class="p">;</span> 
	<span class="nf">isComplete:</span> <span class="bp">false</span><span class="p">.</span></code></pre></figure>
</div>

                    </div>
                </div>                 

                <div class="col-md-12">
                    <div class="elaborate extraTop">
                        <h5>Storing</h5>
                        <p></p>
                    </div>
                </div>

                <div class="col-md-9 workspace">
                    <div class="">
                        <p class="shellTitle">Saving a model</p>
                        <div class="shell">
  <figure class="highlight"><pre><code class="language-st" data-lang="st"><span></span><span class="c">&quot;Saving the task object&quot;</span>
  <span class="nv">repository</span> <span class="nf">do:</span> [ <span class="nv">task</span> <span class="nf">save</span> ]<span class="p">.</span>

  <span class="c">&quot;Saving the task object when its class implements getRepository&quot;</span>
  <span class="nv">task</span> <span class="nf">save</span><span class="p">.</span>
  </code></pre></figure>
</div>

                    </div>
                </div> 

                 <div class="col-md-12 ">
                    <div class="elaborate extraTop">
                        <h5 id="getting">Querying</h5>
                        <p>Mapless can use different persistent backends and depending on which one you're using is how you implement the queries for your data. For example when Mapless has a PostgreSQL or SQLite backend you'll be using SQL, when it has MongoDB it uses the <a href="http://smalltalkhub.com/#!/~MongoTalkTeam/mongotalk">MongoTalk</a> querying feature and for Redis you'll be using a namespaced convention.</p>
                    </div>
                </div>

                <div class="col-md-9 workspace">
                    <div class="">
                        <p class="shellTitle">Fetching objects</p>
                        <div class="shell">
  <figure class="highlight"><pre><code class="language-st" data-lang="st"><span></span><span class="c">&quot;Get all models of a given Mapless class from the repository&quot;</span>
    <span class="nv">allTasks</span> <span class="o">:=</span> <span class="nv">repository</span> <span class="nf">findAll:</span> <span class="nc">Task</span><span class="p">.</span>

    <span class="c">&quot;Same but when your Mapless class can do its own getRepository&quot;</span>
    <span class="nv">allTasks</span> <span class="o">:=</span> <span class="nc">Task</span> <span class="nf">findAll</span><span class="p">.</span>

    <span class="c">&quot;Getting a specific model using its id&quot;</span>
    <span class="nv">thatTask</span> <span class="o">:=</span> <span class="nc">Task</span> <span class="nf">findId:</span> <span class="s">&#39;c472099f-79b9-8ea2-d61f-e5df34b3ed06&#39;</span><span class="p">.</span>

    <span class="c">&quot;The Mapless models that are stored in MongoDB can use MongoTalk querying features&quot;</span>
    <span class="nv">thatTask</span> <span class="o">:=</span> <span class="nc">Task</span> <span class="nf">findOne:</span> { <span class="ss">#description</span> <span class="nf">-&gt;</span> <span class="s">&#39;Try Mapless&#39;</span> } <span class="nf">asDictionary</span><span class="p">.</span>
    
    <span class="c">&quot;All tasks of a given user&quot;</span>
    <span class="nv">allUserTasks</span> <span class="o">:=</span> <span class="nc">Task</span> <span class="nf">find:</span> { <span class="ss">#username</span> <span class="nf">-&gt;</span> <span class="s">&#39;tasksninja&#39;</span> } <span class="nf">asDictionary</span><span class="p">.</span>

    <span class="c">&quot;Second batch of 10 tasks about trying something ordered by description&quot;</span>
    <span class="nv">criteria</span> <span class="o">:=</span> { <span class="ss">#description</span> <span class="nf">-&gt;</span> { <span class="s">&#39;$regex&#39;</span> <span class="nf">-&gt;</span> <span class="s">&#39;^Try.*&#39;</span> } <span class="nf">asDictionary</span> } <span class="nf">asDictionary</span><span class="p">.</span>
    <span class="nv">userTasksAboutTryingThings</span> <span class="o">:=</span> <span class="nc">Task</span> <span class="nf">find:</span> <span class="nv">criteria</span>
      <span class="nf">limit:</span> <span class="m">10</span>
      <span class="nf">offset:</span> <span class="m">20</span>
      <span class="nf">sort:</span> { <span class="ss">#description</span> <span class="nf">-&gt;</span> <span class="m">1</span> } <span class="nf">asDictionary</span><span class="p">.</span>   

    <span class="c">&quot;Same query but with a PostgreSQL backend instead&quot;</span>
    <span class="nv">criteria</span> <span class="o">:=</span> <span class="s">&#39;maplessData-&gt;&gt; &#39;&#39;description&#39;&#39; LIKE &#39;&#39;Try%&#39;&#39;&#39;</span><span class="p">.</span>
    <span class="nv">userTasksAboutTryingThings</span> <span class="o">:=</span> <span class="nc">Task</span> <span class="nf">find:</span> <span class="nv">criteria</span>
      <span class="nf">limit:</span> <span class="m">10</span>
      <span class="nf">offset:</span> <span class="m">20</span>
      <span class="nf">sort:</span> <span class="s">&#39;description DESC&#39;</span><span class="p">.</span>
    </code></pre></figure>
</div>

                    </div>
                </div> 

                 <div class="col-md-12 ">
                    <div class="elaborate extraTop">
                        <h5 id="adding">Making the queries powerful</h5>
                        <p>Let's say you are using a MongoDB backend and want a production ready query by <code>username</code> for this <code>Task</code> data model. All you have to do is to <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.createIndex/" target="_blank">create an index in MongoDB</a> for <code>username</code> in the <code>Task</code> collection, and if it's of your preference, a class method in <code>Task</code> for the query.</p>
                    </div>
                </div>

                <div class="col-md-9 workspace">
                    <div class="">
                        <p class="shellTitle">Querying efficiently</p>
                        <div class="shell">
  <figure class="highlight"><pre><code class="language-st" data-lang="st"><span></span><span class="nc">Task</span> <span class="nf">class&gt;&gt;findAtUsername:</span> <span class="nv">aString</span>
        <span class="c">&quot;Answer the Task with the given username or nil if there is no match for it.&quot;</span>
        <span class="o">^</span> <span class="bp">self</span> <span class="nf">findOne:</span> { <span class="ss">#username</span> <span class="nf">-&gt;</span> <span class="nv">aString</span> } <span class="nf">asDictionary</span><span class="p">.</span>

  <span class="c">&quot;Query objects using an indexed attribute&quot;</span>
  <span class="nv">tasks</span> <span class="o">:=</span> <span class="nv">repository</span> <span class="nf">do:</span> [ <span class="nc">Task</span> <span class="nf">findAtUsername:</span> <span class="s">&#39;tasksninja&#39;</span> ]<span class="p">.</span>
  </code></pre></figure>
</div>

                    </div>
                </div> 

                 <div class="col-md-12 ">
                    <div class="elaborate extraTop">
                        <h5 id="updating">Adding properties to models</h5>
                        <p>Simply do it. Unless overriden, Mapless catches all messages you send to a model via <a href="https://wiki.c2.com/?DoesNotUnderstand" target="_blank">DNU</a>. It is smart enough to allow you to add a date a string or almost any other object without declaring instVars or demanding making schemas or any accessors for it.</p>
                    </div>
                </div>

                <div id="simple" class="col-md-9 workspace">
                    <div class="">
                        <p class="shellTitle">Adding information to your data</p>
                        <div class="shell">
<figure class="highlight"><pre><code class="language-st" data-lang="st"><span></span><span class="c">&quot;Adds or updates values of the model properties, then saves&quot;</span>
<span class="nv">repository</span> <span class="nf">do:</span> [
    <span class="nv">task</span> 
        <span class="nf">deadline:</span> <span class="nc">Date</span> <span class="nf">tomorrow</span><span class="p">;</span> 
        <span class="nf">notes:</span> <span class="s">&#39;Wonder how it feels to use this thing, hmm...&#39;</span><span class="p">;</span>
        <span class="nf">save</span> ]<span class="p">.</span>

<span class="c">&quot;No, wait! we forgot to add this...&quot;</span>
<span class="nv">repository</span> <span class="nf">do:</span> [
    <span class="nv">task</span> 
        <span class="nf">priority:</span> <span class="ss">#high</span><span class="p">;</span>
        <span class="nf">save</span> ]<span class="p">.</span>

<span class="c">&quot;...and this&quot;</span>
<span class="nv">repository</span> <span class="nf">do:</span> [
    <span class="nv">task</span> 
        <span class="nf">tags:</span> <span class="ss">#(</span><span class="s">&#39;flexible&#39;</span> <span class="s">&#39;portable&#39;</span><span class="ss">)</span><span class="p">;</span>
        <span class="nf">save</span> ]<span class="p">.</span></code></pre></figure>
</div>

                    </div>
               </div> 

                 <div id="composability" class="col-md-12 ">
                    <div class="elaborate">
                        <h5 id="adding">Composition</h5>
                        <p>When you model data with your own Mapless classes, you can add almost any property to them, specially other Mapless models, hence composition. When that happens, Mapless will use one collection or table in the backend per type of Mapless object.</p>
                        <p>The main rule when working with composition here is <em>save the children first</em>.</p>
                    </div>
                </div>


                <div  class="col-md-9 workspace">
                    <div class="">
                        <p class="shellTitle">Composing models</p>
                        <div class="shell">
  <figure class="highlight"><pre><code class="language-st" data-lang="st"><span></span> 
<span class="c">&quot;Create and save a new alert for the task, </span>
<span class="c">then add it to the task and save the task&quot;</span> 
  <span class="nv">repository</span> <span class="nf">do:</span> [ <span class="o">|</span> <span class="nv">anAlert</span> <span class="nf">|</span> 
    
    <span class="c">&quot;Create new alert and save it&quot;</span>
    <span class="nv">alert</span> <span class="o">:=</span> <span class="nc">Alert</span> <span class="nb">new</span> 
      <span class="nf">duration:</span> <span class="m">24</span> <span class="nf">hours</span><span class="p">;</span>
      <span class="nf">message:</span> <span class="s">&#39;Get it done!&#39;</span><span class="p">;</span> 
      <span class="nf">save</span><span class="p">.</span> 

    <span class="c">&quot;Update the task having that saved alert&quot;</span>
    <span class="nv">task</span> <span class="nf">alert:</span> <span class="nv">alert</span><span class="p">.</span> 
    <span class="nv">task</span> <span class="nf">save</span> ]<span class="p">.</span> 
  </code></pre></figure>
</div>

                    </div>
                </div> 

                <div class="col-md-12 ">
                    <div class="elaborate extraTop">
                        <h5 id="adding">Graph navigation</h5>
                        <p>When you save a Mapless object, you are planting the root of a graph. When you send a message to a composed Mapless object, reaching to the child Mapless is like navigating the object graph one level deeper. Mapless objects that are composed will return lazy references for every (sub)mapless known by the parent. When you send a message to a (sub)model, the DNU method will return it resolving as if it was always there.</p>
                        <p>At the same time, if a Mapless object never sends any message to a child, then your application is not doing any unnecessary query for that and your backend will say thanks for preventing it do unnecessary extra work.</p>
                    </div>
                </div>

                <div class="col-md-9 workspace">
                    <div class="">
                        <p class="shellTitle">Navigating model graphs</p>
                        <div class="shell">
<figure class="highlight"><pre><code class="language-st" data-lang="st"><span></span><span class="c">&quot;The alert property has an instance of MaplessReference&quot;</span>
<span class="nv">repository</span> <span class="nf">do:</span> [ <span class="nv">task</span> <span class="nf">alert</span> <span class="nf">class</span> <span class="nf">=</span> <span class="nc">MaplessReference</span> ]<span class="p">.</span>
<span class="c">&quot;=&gt; true&quot;</span>

<span class="c">&quot;Alert as (sub)model in task, is lazily fetched with the first message </span>
<span class="c">and responding as if always would have been ready&quot;</span>
<span class="nv">repository</span> <span class="nf">do:</span> [ <span class="nv">task</span> <span class="nf">alert</span> <span class="nf">message</span> ]<span class="p">.</span>
<span class="c">&quot;=&gt; &#39;Get it done!&#39;&quot;</span></code></pre></figure>
</div>

                    </div>
                </div> 

                <div class="col-md-12 ">
                    <div class="elaborate extraTop">
                        <h5 id="portability">Supported backends</h5>
                        <p>All Mapless subclasses have the same basic Smalltalk API and at the time to resolve the requested operations they delegate that in a <code>MaplessRepository</code> subclass corresponding to one of the concrete supported backends.</p>
                        <p>The following are currently supported:</p>
                        <ol>
                            <li>SQLite.</li>
                            <li>PostgreSQL.</li>
                            <li>MongoDB.</li>
                            <li>Redis.</li>
                            <li>Memory.</li>
                            <li><s>UnQLite</s>. Deprecated and retiring soon.</li>
                        </ol>
                    </div>
                </div>

                 <div id="why" class="col-md-12 ">
                    <div class="fluid extraTop">
	<div class="row">
	    <div class="col-md-7 h5NoTop">
	        <h5 class="h5NoTop">Why Mapless?</h5>
	        <div class="thumb">
	            <a href="https://sebastiansastre.co/" target="_blank" >
								<img alt="Sebastian Sastre portrait" src="images/p3.jpg" width="68">
	            </a>
	        </div>

	        <blockquote>I wanted to persist objects with <i>low friction</i>, <i>low maintenance</i> but high <i>scale</i>, <i>throughput</i> and <i>availability</i> capabilities and <a href="http://github.com/sebastianconcept/Mapless" target="_blank">Mapless</a> is totally biased towards that. This framework is what I came up with after incorporating my SaaS experience with <a href="https://www.youtube.com/watch?v=7Z29q5PUoJs" target="_blank">airflowing</a>.
	        </blockquote>
	    </div>
	    <ul class="col-md-5 thereIsNo">
	      <li>There are no instVars...</li>
	      <li>No accessors...</li>
	      <li>No object-mapping impedance...</li>
	      <li></br>— Only persistence.</li>
	      <li></br>What would you do with it?</li>
	    </ul>
	</div>
</div>
                </div>

                 <div id="involved" class="col-md-12 ">
                    <div class="elaborate">
                        <h5 class="">Frequently Asked Questions</h5>
                            <p><em>What saving 'Models' means? why not any object?</em></p>
                            <p>By models Mapless means that you are not pretending to save transient stuff like contexts or sockets or file handlers, etc. Any instance of a <code>Mapless</code> subclass will save in a breeze. Those instances are going to be serialized and stored as documents of its own MongoDB collection or PostgreSQL table.<p>
                            <p><em>Is only for tree-like structures or does actually support an object graph?</em></p>
                            <p>Given that you follow its rules,like saving children first and thinking your models as noSQL friendly documents, yes, it does support an arbitrary object graph.<p>
                            <p><em>Why would I want to use Mapless?</em></p>
                            <p> Because you might want to profit from some of these benefits:
                            <ol>
                                <li>JSON friendly persisted models.</li>
                                <li>Having frictionless system interoperability with Ruby and NodeJS and any JSON friendly object oriented app.</li>
                                <li>Dealing with Gigas or Teras order of magnitude databases.</li>
                                <li>High availability via <a href="https://www.mongodb.com/docs/manual/replication/" target="_bank">MongoDB Replica Set features</a> or <a href="https://www.postgresql.org/docs/current/high-availability.html" target="_bank">PostgreSQL Replication</a>.</li>
                                <li>Replication of the whole database across the cloud.</li>
                                <li>World class databases many engineers are familiar to use and <em>maintain</em>.</li>
                                <li>Powerful queries and custom indices.</li>
                                <li>Freedom from <em>a prioristic</em> instVars declarations.</li>
                                <li>Freedom from mappings maintenance <em>when</em> the design changes.</li>                                
                                <li>Cross-image model caching (requires Redis).</li>
                                <li>Cross-image model observation/reaction, horizontally scalling the <a href="http://en.wikipedia.org/wiki/Observer_pattern" >Observer Pattern</a> (requires Redis PUB/SUB).</li>
                            </ol> All that with <em>very low-friction and low-maintenance</em> using one comfortable API.<p>                    
                    </div>
                </div>

                 <div id="direction" class="col-md-12 ">
                    <div class="elaborate">
                        <h5>Need support?</h5>
                        <p>Don't hesitate to reach out in <a href="https://twitter.com/sebastianconcpt" target="_blank">𝕏</a> or <a href="https://www.linkedin.com/in/sebastiansastre/" target="_blank">LinkedIn</a> <a href="https://discord.com/invite/QewZMZa" target="_blank">Pharo Discord server</a> for discussing design possibilities and implementation support.</p>
                    </div>
                </div>

                 <div class="col-md-12">
                    <div class="elaborate ">
                        <h5 class="">License</h5>
                        <p>Since 2014 <a href="http://sebastiansastre.co">Sebastian Sastre</a> published Mapless under the terms of <a href="https://github.com/sebastianconcept/Mapless/blob/master/LICENSE">MIT License</a>.</p>
                </div>
        </section>
</div>
<div>
    <div class="foot">
	<p>Proudly shared by <a href="http://flowingconcept.co" target="_blank">Flowing</a></p>
	<p>Since April 2014</p>
</div>
</div>
    </body>
</html>
